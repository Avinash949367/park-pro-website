<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Slot Management - Park Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    /* Custom teal theme matching register-spot.html */
    .sidebar-bg {
      background: linear-gradient(135deg, #f0fdfd 0%, #e0f2f1 100%);
      border-right: 1px solid #b2dfdb;
    }
    .sidebar-link {
      color: #1e3740;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-bottom: 0.25rem;
    }
    .sidebar-link:hover {
      background-color: #46949d;
      color: white;
      transform: translateX(5px);
      box-shadow: 0 2px 8px rgba(70, 148, 157, 0.3);
    }
    .sidebar-link.active {
      background-color: #46949d;
      color: white;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(70, 148, 157, 0.4);
    }
    .sidebar-section-title {
      color: #46949d;
      font-weight: 700;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      padding-left: 1rem;
      text-transform: uppercase;
      font-size: 0.875rem;
      letter-spacing: 0.05em;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-dropdown-menu {
      display: none;
      transition: all 0.3s ease;
      padding-left: 1rem;
    }
    .sidebar-dropdown-menu.show {
      display: block;
    }
    .main-content {
      background-color: #fafafa;
      min-height: 100vh;
    }
    .slot-card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: all 0.3s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    .slot-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    .slot-image {
      height: 160px;
      background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .slot-image i {
      font-size: 3rem;
      color: #46949d;
    }
    .slot-details {
      padding: 1rem;
      flex-grow: 1;
    }
    .slot-actions {
      padding: 1rem;
      border-top: 1px solid #e0f2f1;
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }
    .btn-primary {
      background-color: #46949d;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }
    .btn-primary:hover {
      background-color: #2e7d7d;
      transform: translateY(-1px);
    }
    .btn-secondary {
      background-color: #6b7280;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }
    .btn-secondary:hover {
      background-color: #4b5563;
      transform: translateY(-1px);
    }
    .btn-success {
      background-color: #10b981;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }
    .btn-success:hover {
      background-color: #059669;
      transform: translateY(-1px);
    }
    .btn-danger {
      background-color: #ef4444;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }
    .btn-danger:hover {
      background-color: #dc2626;
      transform: translateY(-1px);
    }
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-enabled {
      background-color: #d1fae5;
      color: #065f46;
    }
    .status-disabled {
      background-color: #fee2e2;
      color: #991b1b;
    }
    .availability-free {
      background-color: #dbeafe;
      color: #1e40af;
    }
    .availability-booked {
      background-color: #fef3c7;
      color: #92400e;
    }
    .profile-dropdown {
      position: relative;
    }
    .profile-dropdown .dropdown-menu {
      position: absolute;
      right: 0;
      top: 100%;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    .profile-dropdown .dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 sidebar-bg flex flex-col py-6 px-4 shadow-lg fixed inset-y-0 left-0 z-20">
      <div class="text-center mb-8">
        <a href="station_admin_dashboard.html" class="flex items-center justify-center gap-2">
          <img src="../assets/images/logo_edited-removebg-preview.png" alt="Park Pro Logo" class="h-10 w-35 object-contain" loading="lazy" />
          <img src="../assets/images/+-Photoroom.png" alt="Park Pro Logo" class="h-10 w-35 object-contain" loading="lazy" />
        </a>
        <p class="text-sm text-gray-600 mt-1">Station Admin</p>
      </div>

      <!-- Dashboard - Direct Link -->
      <a href="station_admin_dashboard.html" class="sidebar-link">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>

      <!-- Parking Management -->
      <div class="sidebar-section-title" onclick="toggleDropdown('parkingDropdown')">
        <span>Parking Management</span>
        <i class="fas fa-chevron-down transition-transform duration-300" id="parkingIcon"></i>
      </div>
      <div id="parkingDropdown" class="sidebar-dropdown-menu">
        <a href="station_management.html" class="sidebar-link">
          <i class="fas fa-building"></i>
          <span>Manage Station</span>
        </a>
        <a href="slot_management.html" class="sidebar-link active">
          <i class="fas fa-calendar-check"></i>
          <span>Manage Slots & Bookings</span>
        </a>
        <a href="station_visualization.html" class="sidebar-link">
          <i class="fas fa-map-marked-alt"></i>
          <span>Live Parking Map</span>
        </a>
        <a href="station_view_slots.html" class="sidebar-link">
          <i class="fas fa-chart-bar"></i>
          <span>Occupancy History</span>
        </a>
      </div>

      <!-- Payments & Billing -->
      <div class="sidebar-section-title" onclick="toggleDropdown('paymentsDropdown')">
        <span>Payments & Billing</span>
        <i class="fas fa-chevron-down transition-transform duration-300" id="paymentsIcon"></i>
      </div>
      <div id="paymentsDropdown" class="sidebar-dropdown-menu">
        <a href="slot_earning.html" class="sidebar-link">
          <i class="fas fa-money-bill-wave"></i>
          <span>Payment Dashboard</span>
        </a>
      </div>

      <!-- Settings -->
      <div class="sidebar-section-title" onclick="toggleDropdown('settingsDropdown')">
        <span>Settings</span>
        <i class="fas fa-chevron-down transition-transform duration-300" id="settingsIcon"></i>
      </div>
      <div id="settingsDropdown" class="sidebar-dropdown-menu">
        <a href="station_settings.html" class="sidebar-link">
          <i class="fas fa-cog"></i>
          <span>Station Settings</span>
        </a>
      </div>

      <!-- Help & Support -->
      <div class="sidebar-section-title" onclick="toggleDropdown('helpDropdown')">
        <span>Help & Support</span>
        <i class="fas fa-chevron-down transition-transform duration-300" id="helpIcon"></i>
      </div>
      <div id="helpDropdown" class="sidebar-dropdown-menu">
        <a href="faq.html" class="sidebar-link">
          <i class="fas fa-question-circle"></i>
          <span>FAQ / Guides</span>
        </a>
        <a href="contactus.html" class="sidebar-link">
          <i class="fas fa-phone"></i>
          <span>Contact Support</span>
        </a>
      </div>

      <!-- Logout -->
      <a href="station_adminlogin.html" class="sidebar-link mt-8 text-red-600 hover:bg-red-100 hover:text-red-700 border border-red-200">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </a>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 main-content ml-64 p-6">
      <!-- Top bar -->
      <div class="flex justify-between items-center mb-8">
        <div>
          <h1 class="text-3xl font-bold text-[#1e3740]">Slot Management</h1>
          <p class="text-gray-600 mt-1">Manage parking slots and bookings for your station</p>
        </div>
        <div class="flex items-center space-x-4">
          <div class="relative">
            <i class="fas fa-bell text-[#46949d] text-xl cursor-pointer"></i>
            <span class="notification-badge">3</span>
          </div>
          <div class="profile-dropdown">
            <img id="profileImage" src="https://via.placeholder.com/40" alt="Profile" class="rounded-full w-10 h-10 cursor-pointer border-2 border-[#46949d]" />
            <div id="dropdownMenu" class="dropdown-menu">
              <div class="p-4 border-b border-gray-200">
                <p id="profileName" class="font-semibold text-gray-800">Admin User</p>
                <p id="profileEmail" class="text-sm text-gray-600">admin@parkpro.com</p>
              </div>
              <ul class="text-sm text-gray-700">
                <li>
                  <a href="adminprofile.html" class="flex items-center px-4 py-3 hover:bg-[#46949d] hover:text-white rounded transition-colors duration-150">
                    <i class="fas fa-user mr-3"></i>
                    Profile
                  </a>
                </li>
                <li>
                  <a href="station_adminlogin.html" id="signOutLink" class="flex items-center px-4 py-3 hover:bg-[#46949d] hover:text-white rounded transition-colors duration-150">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    Sign Out
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    <!-- Content Area -->
    <main class="p-6 space-y-6">

      <!-- Station Info -->
      <section class="bg-white shadow p-4 rounded">
        <h2 class="text-xl font-semibold mb-2">Station: <span id="station-name">Loading...</span></h2>
        <p><strong>Location:</strong> <span id="station-location">Loading...</span></p>
        <p><strong>ID:</strong> <span id="station-id">Loading...</span></p>
        <p><strong>Total Slots:</strong> <span id="total-slots">0</span></p>
        <!-- Temporary stationId input for debugging -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">Debug: Station ID (leave empty to use from user)</label>
          <input type="text" id="debug-station-id" class="p-2 border rounded" placeholder="Enter stationId to test">
          <button onclick="loadSlotsWithDebugId()" class="ml-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Load Slots</button>
        </div>
      </section>



      <!-- Search & Filters -->
      <section class="bg-white shadow p-4 rounded">
        <div class="flex flex-wrap gap-4 items-center">
          <input type="text" id="search" placeholder="Search by Slot ID or keyword" class="p-2 border rounded flex-1 min-w-64">
          <select id="type-filter" class="p-2 border rounded">
            <option value="All">All Types</option>
            <option value="Car">Car</option>
            <option value="Bike">Bike</option>
            <option value="Van">Van</option>
          </select>
          <select id="price-sort" class="p-2 border rounded">
            <option value="None">Sort by Price</option>
            <option value="Low-High">Low to High</option>
            <option value="High-Low">High to Low</option>
          </select>
          <select id="status-filter" class="p-2 border rounded">
            <option value="All">All Status</option>
            <option value="Enabled">Enabled</option>
            <option value="Disabled">Disabled</option>
          </select>
          <select id="availability-filter" class="p-2 border rounded">
            <option value="All">All Availability</option>
            <option value="Free">Free</option>
            <option value="Booked">Booked</option>
          </select>
          <button onclick="addSlot()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add Slot</button>
        </div>
      </section>

      <!-- Slot Grid -->
      <section>
        <div id="slot-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          <!-- Slots will be rendered here -->
        </div>
      </section>

    </main>
  </div>

  <!-- Modals -->
  <!-- Add Slot Modal -->
  <div id="add-slot-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow-lg w-96">
      <h3 class="text-lg font-semibold mb-4">Add New Slot</h3>
      <form onsubmit="saveSlot(); return false;">
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Type</label>
          <select id="slot-type" class="w-full p-2 border rounded" required>
            <option value="Car">Car</option>
            <option value="Bike">Bike</option>
            <option value="Van">Van</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Price (₹ per hour)</label>
          <input type="number" id="slot-price" class="w-full p-2 border rounded" min="0" step="0.01" required>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeModal('add-slot-modal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Add Slot</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Slot Modal -->
  <div id="edit-slot-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow-lg w-96">
      <h3 class="text-lg font-semibold mb-4">Edit Slot</h3>
      <form onsubmit="saveEdit(); return false;">
        <input type="hidden" id="edit-id">
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Type</label>
          <select id="edit-slot-type" class="w-full p-2 border rounded" required>
            <option value="Car">Car</option>
            <option value="Bike">Bike</option>
            <option value="Van">Van</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Price (₹ per hour)</label>
          <input type="number" id="edit-slot-price" class="w-full p-2 border rounded" min="0" step="0.01" required>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeModal('edit-slot-modal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Book Slot Modal -->
  <div id="book-slot-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow-lg w-96">
      <h3 class="text-lg font-semibold mb-4">Admin Book Slot</h3>
      <form onsubmit="saveBooking(); return false;">
        <input type="hidden" id="book-id">
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">User Email</label>
          <input type="email" id="book-user-email" class="w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Vehicle Number</label>
          <input type="text" id="book-vehicle-number" class="w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Start Time</label>
          <input type="datetime-local" id="book-start" class="w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Duration (hours)</label>
          <input type="number" id="book-duration" class="w-full p-2 border rounded" min="1" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Payment Method</label>
          <select id="book-payment" class="w-full p-2 border rounded" required>
            <option value="Cash">Cash</option>
            <option value="Card">Card</option>
            <option value="Online">Online</option>
          </select>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeModal('book-slot-modal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded">Book Slot</button>
        </div>
      </form>
    </div>
  </div>

  <!-- View Bookings Modal -->
  <div id="view-bookings-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow-lg w-96 max-h-96 overflow-y-auto">
      <h3 class="text-lg font-semibold mb-4">Slot Bookings</h3>
      <div id="bookings-sections">
        <!-- Bookings will be listed here in sections -->
      </div>
      <div class="flex justify-end mt-4">
        <button onclick="closeModal('view-bookings-modal')" class="px-4 py-2 bg-gray-300 rounded">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Check if user is logged in on page load
    document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      const user = JSON.parse(localStorage.getItem('user'));

      if (!token || !user || user.role !== 'store admin') {
        // Redirect to login if not authenticated or not store admin
        window.location.href = 'station_adminlogin.html';
        return;
      }

      // Logout functionality
      const logoutBtn = document.querySelector('button.bg-red-500');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', (e) => {
          e.preventDefault();
          // Clear localStorage
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          localStorage.removeItem('email');
          // Redirect to login
          window.location.href = 'station_adminlogin.html';
        });
      }
    });

    // Add sidebar and profile dropdown for consistency
    const sidebarHtml = `
    <aside class="w-64 bg-gray-800 text-white flex flex-col py-6 px-4 fixed inset-y-0 left-0 z-20">
      <h2 class="text-2xl font-bold mb-10 text-center">🚗 PARK PRO ADMIN</h2>
      <nav class="flex flex-col space-y-4">
        <a href="station_admin_dashboard.html" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>🏠</span><span>Dashboard</span>
        </a>
        <a href="station_management.html" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>🏢</span><span>Manage Station</span>
        </a>
        <a href="gps_mapping.html" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>🗺️</span><span>GPS Mapping</span>
        </a>
        <a href="station_visualization.html" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>📊</span><span>Station View</span>
        </a>
        <a href="slot_management.html" class="flex items-center space-x-2 text-yellow-400">
          <span>📅</span><span>View Bookings</span>
        </a>
        <a href="slot_earning.html" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>💰</span><span>Earnings</span>
        </a>
        <a href="station_settings.html" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>⚙️</span><span>Settings</span>
        </a>
        <a href="#" class="flex items-center space-x-2 hover:text-yellow-400">
          <span>✉️</span><span>Messages</span>
        </a>
        <a href="#" class="flex items-center space-x-2 mt-10 hover:text-red-400">
          <span>🔓</span><span>Logout</span>
        </a>
      </nav>
    </aside>
    `;

    const mainContent = document.querySelector('body > div.flex-1');
    if (mainContent) {
      mainContent.style.marginLeft = '16rem'; // 64 width sidebar
      mainContent.insertAdjacentHTML('beforebegin', sidebarHtml);
    }
  </script>
  <script src="js/slot_management_new.js"></script>
</body>
</html>
